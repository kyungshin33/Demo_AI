<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>T컬러링 차트</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="chart-wrapper">
  <div class="chart-header">
    <span class="back-btn"></span>
    <span class="title">T컬러링 차트</span>
    <span class="search-btn"></span>
  </div>

  <div class="song-list">
    {% for song in songs %}
    <div class="song-row">
      <div class="rank-box">
        <span class="rank">{{ song.rank }}</span>
      </div>
      <div class="thumb">
        <img src="{{ song.thumbnail }}" alt="썸네일">
      </div>
      <div class="song-info">
        <div class="song-title">{{ song.title }}</div>
        <div class="song-artist">{{ song.artist }}</div>
      </div>
      <div class="play-box">
        <button class="play-btn" onclick="togglePlay(this, '{{ song.audio }}')">▶</button>
        <span class="time">00:00</span>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
<script>
  let currentAudio = null;
  let currentBtn = null;
  let timeUpdater = null;

  function togglePlay(btn, audioSrc) {
    const timeSpan = btn.nextElementSibling;

    // 같은 오디오 버튼을 다시 눌렀을 때
    if (currentAudio && currentAudio.src === new Audio(audioSrc).src) {
      if (currentAudio.paused) {
        currentAudio.play();
        btn.textContent = '⏸';  // 플레이 중이면 일시정지 버튼
        startTimer(currentAudio, timeSpan);
      } else {
        currentAudio.pause();
        btn.textContent = '▶';  // 정지되면 재생 버튼으로
        clearInterval(timeUpdater);
      }
      return;
    }

    // 다른 곡이 재생 중이면 멈추기
    if (currentAudio) {
      currentAudio.pause();
      clearInterval(timeUpdater);
      if (currentBtn) {
        currentBtn.textContent = '▶';
        currentBtn.nextElementSibling.textContent = '00:00';
      }
    }

    // 새 오디오로 재생
    currentAudio = new Audio(audioSrc);
    currentAudio.play();
    btn.textContent = '⏸';
    currentBtn = btn;

    startTimer(currentAudio, timeSpan);

    // 곡이 끝났을 때 버튼 초기화
    currentAudio.onended = function() {
      btn.textContent = '▶';
      timeSpan.textContent = '00:00';
      clearInterval(timeUpdater);
    };
  }

  function startTimer(audio, span) {
    timeUpdater = setInterval(() => {
      const m = Math.floor(audio.currentTime / 60).toString().padStart(2, '0');
      const s = Math.floor(audio.currentTime % 60).toString().padStart(2, '0');
      span.textContent = `${m}:${s}`;
    }, 500);
  }
</script>



</body>
</html>
